<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

    <div style="display: flex; position: relative;">

        <span class="bg-danger" style="display: flex; position: absolute; justify-content: center;
        border-radius: 50%; padding: 4px; right: 0px; top: -14px; height: 20px; align-items: center;
        width: 26px; color: #fff; font-size: 10pt;
        ">
            {% if tamanho_caso > 10 %}
                +10
            {% else %}
                {{tamanho_caso}}
            {% endif %}
        </span>
        <button class="btn btn-primary" onclick="abrir_modal()">
            Envolvimentos
        </button>
    </div>
    
    <div  id="modalconfirmacao" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
        <div class="card"  style="position: absolute; top: 50% ; left: 50%; transform: translate(-50%, -50%); height: 630px;
            background: white; min-width: 70%;">

            <div id="previous">

                <span class="page-item" style="display: flex;
                    position: absolute; left: 10px; top: 50%;" id="li1">
                    
                </span>
            </div>


            <div class="d-flex justify-content-between card-header bg-primary text-white"
            style="width: 100%;">

                <h3 >Pessoas envolvidas no caso nº {{caso.numero_caso}}</h3>
                <button onclick="fecharmodal()" class="btn" style=" background-color: blue; color: red;
                    margin-right: 10px; width: 40px; height: 40px; border-radius: 50%;">
                    X
                </button>
                
            </div>
            {% for envolvimento in  envolvimentos%}
                <div style="display: flex; flex-direction: column; gap: 10px;
                margin-left: 50px; padding-top: 10px; overflow-y: auto;"   id="pessoa">
                    
                </div>
            {% endfor %}
            
            <div id="proximo"  data-id="{{caso.id}}">
                    
                <span class="page-item"  style="display: flex; position: absolute; right: 10px; top: 50%;" id="li">
                    
                </span>
            </div>

        </div>

    </div>

    <script>
        let itemparadeletar = null;
        
        function abrir_modal() {
            document.getElementById('modalconfirmacao').style.display = 'block';
        }
        
        function fecharmodal() {
            document.getElementById('modalconfirmacao').style.display = 'none';
            itemparadeletar = null;
        }

        document.getElementById('modalconfirmacao').onclick = (e)=>{
            if (e.target === this) {
                fecharmodal();
            }
        }

        $(document).ready(function(){

            function loadPaginacao(page=1){
                let caso_id = $('#proximo').data('id')
             
                let nome = $(this).data('nome')
                
                $.ajax(
                    {
                        url: `/detail_case/${caso_id}?page=${page}`,
                        type: 'GET',
                        dataType: 'json',
                        success: function(res){
                            dados = res.evidencia_obj[0].dados[0].image
                            pessaosDados(res.evidencia_obj[0].dados[0].pessoa, res.evidencia_obj[0].dados[0], dados)
                            proximo(res.evidencia_obj[0].dados[0].paginacao)
                        }
                    }
                )
            }

            function proximo(paginacao){
                
                const co1 = $('#li1')
                const co = $('#li')
                co.empty()
                co1.empty()
                console.log(paginacao.has_next)
                if(paginacao.has_next){
                     let v = 0
                     console.log(v)

                    co.append(
                        $('<button>').text('>').addClass('btn btn-primary').click(()=>{
                            loadPaginacao(paginacao.page_atual + 1)
                        })
                    )
                }

                if (paginacao.has_previous){

                    

                    co1.append(
                        $('<button>').text('<').addClass('btn btn-primary').click(()=>{
                            let v= paginacao.page_atual - 1
                            loadPaginacao(v)
                        })
                    )
                }

                
            }

            function anterior(has_previous, previous_page_number){
                $('#previous1').hide()
                v= previous_page_number - 1
                $('#previous').html(`
                ${
                    has_previous ? ` <li class="page-item" style="display: flex;
                                position: absolute; left: 10px; top: 50%;">
                                
                                <button class="btn btn-primary" id="anterior" data-id="{{caso.id}}"
                                data-nome="?page=${ v }" 
                                aria-label="Previous">
                                    <span aria-hidden="true"><</span>
                                </button>
                            </li>`: ''
                }
                `)
                
            }

            function pessaosDados(pessoa, envolvimento, image){
                const p = $('#pessoa')

                p.empty()
                p.html(`
                        <div style="display: flex; flex-direction: column; gap: 10px;
                         padding-top: 0px; overflow-y: auto;">

                            <h4 class="text-danger">PAPEL: ${envolvimento.tipo_envolvimento.toUpperCase()}</h4>

                            <div class="d-flex" style="margin-top: 10px; margin-left: 10px; gap: 10px;">
                                <div style=" font-size: 20pt; border: 1px solid #ddd; width: 150px; height: 200px;">
                                   <img src='${image}' style='height: 100%; width: 100%;'/>
                                </div> 

                                <div style="display: flex; flex-direction: column;">
                                    <span><strong>NOME COMPLETO :</strong> ${pessoa.nome_completo}</span>
                                    <span><strong>NOME SOCIAL:</strong> ${pessoa.nome_social}</span>
                                    <span><strong>BI:</strong> ${pessoa.bi}</span>
                                    <span><strong>IDADE:</strong> ${pessoa.idade} anos</span>
                                </div>
                            </div>
                            <div style="display: flex; flex-direction: column; margin-left: 20px; gap: 10px;">
                                <span><strong>Estado do envolvimento:</strong> 
                                    
                                    ${ envolvimento.ativo?
                                        '<span class="badge bg-success">Ativo</span>'
                                        :
                                        '<span class="badge bg-danger">Inativo</span>'

                                    }
                                </span>
                                ${
                                pessoa.genero == 'F' ? '<span><strong>Gênego: </strong>Feminino</span>': ''}
                                ${pessoa.genero == 'M'? '<span><strong>Gênego: </strong>Masculino</span>': ''}
                                ${pessoa.genero == 'O' ? '<span><strong>Gênego: </strong>Outro</span>': ''}
                                
                                <span><strong>Cor dos olhos: </strong>${pessoa.cor_olhos || 'Sem Informação'}</span>
                                <span><strong>Cor de cabelo: </strong>${pessoa.cor_cabelo || 'Sem Informação'}</span>
                                <span><strong>Peso: </strong>${pessoa.peso || 'Sem Informação'}</span>
                                <span><strong>Altura: </strong>${pessoa.altura || 'Sem Informação'}</span>
                                <span><strong>Profissão: </strong>${pessoa.profissao || 'Sem Informação'}</span>
                                <span><strong>Nível acadêmico: </strong>${pessoa.escolaridade || 'Sem Informação'}</span>
                                <span><strong>Nacionalidade: </strong>${pessoa.nacionalidade || 'Sem Informação'}</span>
                                <span><strong>Telefone principal: </strong>${pessoa.telefone_principal || 'Sem Informação'}</span>
                                <span><strong>Telefone secundário: </strong>${pessoa.telefone_secundario || 'Sem Informação'}</span>
                                <span><strong>E-mail: </strong>${pessoa.email || 'Sem Informação'}</span>
                                <span><strong>Descrição: </strong>${envolvimento.descricao || "Sem informações"}</span>

                                <a href='/detail_individual_invalid/${pessoa.id}'> Ver mais detalhes</a>
                            </div>
                        </div>
                `)
            }
            loadPaginacao(1)
        })


    </script>
</body>
</html>